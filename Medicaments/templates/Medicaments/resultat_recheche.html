{% extends "Medicaments/base.html" %}
{% load static %}

{% block content %}

{% if messages %}
<ul class="messages">
    {% for message in messages %}                            
    <li {% if message.tags %} class="{{ message.tags }}" {% endif %} style="color: green;">
        {{ message }}
    </li>
    {% endfor %}
</ul>
{% endif %}

<h1 style="color: brown;">Résultat de la recherche</h1>

<div class="products-area-wrapper tableView">

  <style>
    .button {
      padding: 5px 10px;
      border-radius: 5px;
      font-weight: bold;
      text-align: center;
      color: white;
    }
    .red { background-color: red; }
    .orange { background-color: orange; }
    .green { background-color: green; }
  </style>

  <!-- ======= HEADER TABLE ======= -->
  <div class="products-header">
    <div class="product-cell image">Nom Produit</div>
    <div class="product-cell category">Catégories</div>
    <div class="product-cell status-cell">Statut & Quantité</div>
    <div class="product-cell sales">Prix</div>
    <div class="product-cell stock">Description</div>
    <div class="product-cell price">Date Ajout</div>
    <div class="product-cell price">Date Expiration</div>
    <div class="product-cell price">Actions</div>
  </div>
  <!-- ======= FIN HEADER ======= -->


  {% if donnees %}
  
  {% for n in donnees %}
  <div class="products-row" id="produit-{{ n.id }}">

      <div class="product-cell image">
        {% if n.img %}
          <img src="{{ n.img.url }}" alt="product">
        {% else %}
          <img src="{% static '1.jpeg' %}" alt="product">
        {% endif %}
        <span>{{ n.name }}</span>
      </div>

      <div class="product-cell category">{{ n.category }}</div>

      <div class="product-cell status-cell">
        <span class="status active">
          <button class="button {{ n.statut_quantite }}"></button> {{ n.quantite }}
        </span>
      </div>

      <div class="product-cell sales">{{ n.price }} FCFA</div>

      <div class="product-cell stock">{{ n.description }}</div>

      <div class="product-cell price">{{ n.date_ajout }}</div>

      <div class="product-cell price">{{ n.date_expiration }}</div>

      <!-- ======= ACTIONS ======= -->
      <div class="product-cell price">

        <!-- ✅ AJOUT AU PANIER -->
        <a href="{% url 'ajouter_au_panier' n.id %}"
           class="btn btn-success"
           title="Ajouter au panier">
          <i class="bi bi-cart-plus"></i>
        </a>

        <!-- MODIFIER -->
        <a href="{% url 'modifier' n.pk %}" class="btn btn-info">
          <i class="bi bi-pencil-square"></i>
        </a> 

        <!-- SUPPRIMER -->
        <a class="btn btn-danger">
          <i class="bi bi-trash3 delete-button" data-id="{{ n.id }}"></i>
        </a>

        <!-- DETAILS -->
        <a href="{% url 'details' n.pk %}" class="btn btn-primary">
          <i class="bi bi-info-circle"></i>
        </a> 

      </div>
      <!-- ======= FIN ACTIONS ======= -->

  </div>
  {% endfor %}

  {% else %}
     <h2>Aucun résultat trouvé</h2>
  {% endif %}

</div>


<!-- ======= SCRIPT SUPPRESSION AJAX ======= -->
<script src="{% static 'jquery-3.7.1.min.js' %}"></script>

<script>
$(document).ready(function() {
  $('.delete-button').on('click', function() {
      var produitId = $(this).data('id');
      $.ajax({
          url: '/supprimer/' + produitId + '/',
          type: 'POST',
          data: {
              'csrfmiddlewaretoken': '{{ csrf_token }}'
          },
          success: function(response) {
              if (response.success) {
                  $('#produit-' + produitId).remove();
              } else {
                  alert('Erreur lors de la suppression.');
              }
          },
          error: function() {
              alert('Erreur lors de la suppression.');
          }
      });
  });
});
</script>

{% endblock %}
